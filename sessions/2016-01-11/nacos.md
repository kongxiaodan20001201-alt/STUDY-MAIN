**日期**: 2026-01-21
**当前进度**: C 模块 (Nacos) 完成 -> D 模块 (微服务架构) 开启
**状态**: 🚀 核心攻坚中

---

## 🎓 第一部分：Nacos 架构深度复盘 (C 模块毕业总结)

> **核心心智模型**：Nacos = **注册中心 (一楼点名)** + **配置中心 (二楼发文)**
> Nacos 是一个“双面人”，由两套完全独立的系统组合而成。

### 1. 核心架构对比

| 功能模块 | **注册中心 (Naming)** | **配置中心 (Config)** |
| :--- | :--- | :--- |
| **形象比喻** | **一楼大厅 (点名)** | **二楼档案室 (发文)** |
| **核心目标** | **AP (高可用)**：活着最重要 | **CP (强一致)**：准确最重要 |
| **一致性协议** | **Distro** (自研)：分片、异步复制、无 Leader | **Raft** (标准)：选举、过半写入、有 Leader |
| **存储方式** | **内存** (Map) + 本地快照 | **MySQL** (主) + 本地磁盘 (备) |
| **交互模式** | **客户端心跳** (5s 一次) | **服务端长轮询** (Hold 住 29.5s) |

### 2. 源码级黑科技 (面试必杀技)

* **写时复制 (CopyOnWrite)**
    * **场景**：注册中心更新服务列表。
    * **原理**：修改内存 Map 时，先 Copy 一份副本进行修改，改完瞬间替换引用。
    * **价值**：实现**读操作完全无锁**，极大提升了服务发现的高并发读取性能。

* **长轮询 (Long Polling)**
    * **场景**：配置中心推送变更。
    * **原理**：利用 Servlet 3.0 异步特性，服务端将客户端请求 **挂起 (Hold) 29.5 秒**。有变更立即返回，无变更超时返回 304。
    * **价值**：兼顾了 Push 的**实时性**与 Pull 的**轻量级**，避免海量长连接消耗。

* **存算分离 (Nacos 2.x)**
    * **场景**：支撑十万级节点连接。
    * **原理**：**连接层**（维持 gRPC TCP）与 **逻辑层**（处理服务数据）物理分离。通过内部路由转发，实现水平扩展。

### 3. 请求链路中的角色认知
* **战时旁路**：Nacos 只是“电话本”。服务 A 调用 服务 B 时，是 **P2P 直连**，流量**绝不经过** Nacos。
* **兜底机制**：即使 Nacos 集群全挂，客户端本地内存有缓存，短期内业务不受影响。